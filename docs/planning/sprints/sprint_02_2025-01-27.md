# **Sprint 2: Authentication & Database Schema**

Sprint Duration: January 27, 2025 - February 2, 2025  
Primary Goal: Establish secure authentication flow and implement complete database schema for the AI Fitness Companion.

## **Tasks**

This board follows the "Rule of One": Only one item should be in the "IN PROGRESS" section at any time.

### **TODO**

* [ ] **Task 1: Design Database Schema**
  - Description: Define all tables, columns, and relationships for the fitness companion data model
  - User Story: As a developer, I want a clear database design so that I can implement it correctly
  - Dependencies: None
  - Estimated Effort: 3 hours
  - Acceptance Criteria:
    - All tables documented (Users, Plans, Exercises, Sets, Memories)
    - Column types and constraints defined
    - Relationships between tables mapped
    - Vector column for memories specified
  - Assigned To: database-architect agent for schema design

* [ ] **Task 2: Create Users Table in Supabase**
  - Description: Implement the Users table with all required fields in the Supabase PostgreSQL database
  - User Story: As a user, I want my profile data stored securely so that I can access my fitness information
  - Dependencies: Task 1
  - Estimated Effort: 2 hours
  - Acceptance Criteria:
    - Users table created with proper columns
    - Constraints and indexes applied
    - Row-level security policies configured
    - Test data can be inserted successfully
  - Assigned To: Developer with Supabase console access

* [ ] **Task 3: Create Plans Table in Supabase**
  - Description: Implement the Plans table for storing workout plan templates
  - User Story: As a user, I want to save my workout plans so that I can reuse them
  - Dependencies: Task 1, Task 2
  - Estimated Effort: 2 hours
  - Acceptance Criteria:
    - Plans table created with foreign key to Users
    - Proper constraints for plan data
    - Row-level security configured
    - Relationship to Users table verified
  - Assigned To: Developer with Supabase console access

* [ ] **Task 4: Create Exercises Table in Supabase**
  - Description: Implement the Exercises table for the exercise library
  - User Story: As a user, I want access to a library of exercises so that I can build varied workouts
  - Dependencies: Task 1
  - Estimated Effort: 2 hours
  - Acceptance Criteria:
    - Exercises table created with all required fields
    - Initial exercise data populated
    - Proper indexing for search functionality
  - Assigned To: Developer with Supabase console access

* [ ] **Task 5: Create Sets Table in Supabase**
  - Description: Implement the Sets table for logging workout performance data
  - User Story: As a user, I want to track my sets, reps, and weights so that I can monitor progress
  - Dependencies: Task 1, Task 3, Task 4
  - Estimated Effort: 2 hours
  - Acceptance Criteria:
    - Sets table created with proper relationships
    - Foreign keys to Plans and Exercises established
    - Constraints for valid data ranges applied
  - Assigned To: Developer with Supabase console access

* [ ] **Task 6: Create Memories Table with Vector Column**
  - Description: Implement the Memories table with pgvector support for semantic search
  - User Story: As a user, I want the AI to remember our past conversations so that it provides personalized advice
  - Dependencies: Task 1, Task 2
  - Estimated Effort: 3 hours
  - Acceptance Criteria:
    - Memories table created with vector column
    - pgvector extension enabled in Supabase
    - Vector dimension properly configured
    - Test vector insertion successful
  - Assigned To: Developer with Supabase console access

* [ ] **Task 7: Design JWT Validation Flow**
  - Description: Plan the authentication flow for validating Supabase JWTs in FastAPI
  - User Story: As a user, I want secure access to my data so that only I can view and modify it
  - Dependencies: None
  - Estimated Effort: 2 hours
  - Acceptance Criteria:
    - Authentication flow documented
    - JWT validation process defined
    - Error handling scenarios identified
    - Security considerations addressed
  - Assigned To: api-architect agent for flow design

* [ ] **Task 8: Implement JWT Validation Dependency**
  - Description: Create a FastAPI dependency that validates incoming Supabase JWTs
  - User Story: As a user, I want my API requests authenticated so that my data remains private
  - Dependencies: Task 7
  - Estimated Effort: 4 hours
  - Acceptance Criteria:
    - Dependency validates JWT signature
    - Extracts user_id from valid tokens
    - Returns appropriate errors for invalid tokens
    - Can be applied to protected endpoints
  - Assigned To: Developer for implementation

* [ ] **Task 9: Create Protected Endpoint Example**
  - Description: Build a sample protected endpoint to verify authentication is working
  - User Story: As a developer, I want to test that authentication works so that I can build secure endpoints
  - Dependencies: Task 8
  - Estimated Effort: 1 hour
  - Acceptance Criteria:
    - Endpoint requires valid JWT
    - Returns user-specific data when authenticated
    - Returns 401 error when unauthenticated
    - Includes proper error messages
  - Assigned To: Developer for implementation

* [ ] **Task 10: Document Database Relationships**
  - Description: Create clear documentation of all table relationships and constraints
  - User Story: As a developer, I want relationship documentation so that I can write correct queries
  - Dependencies: Tasks 2-6
  - Estimated Effort: 2 hours
  - Acceptance Criteria:
    - ER diagram or relationship map created
    - Foreign key relationships documented
    - Cascade behaviors defined
    - Query examples provided (conceptual only)
  - Assigned To: Developer or database-architect agent

### **IN PROGRESS**

* **Currently Working On:** [Move the single active task description here]

### **DONE**

* [x] **Sprint 1 Completed:** FastAPI project initialized, Ruff configured, initial Render deployment successful

## **Notes & Blockers**

* **January 27, 2025:** Sprint 2 planning completed. Focus is on establishing the data foundation and secure access patterns.
* **Blockers:** 
  - Supabase project needs to be created if not already done
  - pgvector extension must be available in Supabase plan
  - Need Supabase service role key for backend JWT validation
* **AI Assistant Log:** Sprint planning created by project-manager agent to organize authentication and database tasks.

## **Dependencies Map**

```
Task 1 (Schema Design) → Tasks 2-6 (Table Creation)
                      ↓
Task 2 (Users) → Task 6 (Memories)
             ↓
Task 3 (Plans) → Task 5 (Sets)
             ↓
Task 4 (Exercises) → Task 5 (Sets)

Task 7 (JWT Flow Design) → Task 8 (JWT Implementation) → Task 9 (Protected Endpoint)

All Tables (Tasks 2-6) → Task 10 (Documentation)
```

## **Risk Assessment**

1. **pgvector Availability**: Ensure Supabase plan includes pgvector extension
2. **JWT Secret Management**: Secure storage of Supabase JWT secret needed
3. **Database Migration Strategy**: Plan for future schema changes
4. **Performance Considerations**: Vector search performance should be tested early

## **Success Metrics**

- All 5 database tables created and functional
- JWT validation working for protected endpoints
- Database relationships properly enforced
- Vector search capability verified
- Zero security vulnerabilities in authentication flow